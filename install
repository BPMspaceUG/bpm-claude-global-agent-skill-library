#!/usr/bin/env bash
#
# Install cgasl command for Claude Global Agents & Skills Library
#
# Usage: curl -fsSL https://raw.githubusercontent.com/BPMspaceUG/bpm-claude-global-agent-skill-library/main/install | bash

set -euo pipefail

CGASL_URL="https://raw.githubusercontent.com/BPMspaceUG/bpm-claude-global-agent-skill-library/main/cgasl"
USER_BIN="$HOME/.local/bin"
GLOBAL_BIN="/usr/local/bin"

echo "Claude Global Agents & Skills Library - Install"
echo ""
echo "  [1] User install   - ~/.local/bin/cgasl (current user only)"
echo "  [2] Global install - /usr/local/bin/cgasl (all users, requires sudo)"
echo ""

# Read choice from /dev/tty for pipe compatibility
read -p "Choose [1/2]: " -n 1 -r </dev/tty 2>/dev/null || REPLY="1"
echo ""

if [[ $REPLY == "2" ]]; then
  # Global install
  echo "Installing globally (requires sudo)..."
  sudo curl -fsSL "$CGASL_URL" -o "$GLOBAL_BIN/cgasl"
  sudo chmod +x "$GLOBAL_BIN/cgasl"
  echo ""
  echo "Installed to $GLOBAL_BIN/cgasl"
else
  # User install
  mkdir -p "$USER_BIN"
  curl -fsSL "$CGASL_URL" -o "$USER_BIN/cgasl"
  chmod +x "$USER_BIN/cgasl"
  echo ""
  echo "Installed to $USER_BIN/cgasl"

  # Check if ~/.local/bin is in PATH
  if [[ ":$PATH:" != *":$USER_BIN:"* ]]; then
    echo ""
    echo "NOTE: Add ~/.local/bin to your PATH:"
    echo "  echo 'export PATH=\"\$HOME/.local/bin:\$PATH\"' >> ~/.bashrc"
    echo "  source ~/.bashrc"
  fi
fi

echo ""
echo "Usage:"
echo "  cgasl         - Install/update agents & skills"
echo "  cgasl --n8n   - Install/update with n8n skills"
echo "  cgasl --help  - Show help"
